---
layout: post
title: The limit of cookies's length
author: mop
shortname: cookies-length-limit
---

<p>由于项目的需要，进行一个COOKIE内容长度的限制测试，作一个记录供参考，测试设计如下，分两种情况：</p>
<p>&nbsp; (1) 当前页面未设置同名Cookie的情况；</p>
<p>&nbsp; (2) 当前页面已设置同名Cookie的情况；</p>
<p>主要测试代码如下：</p>
<div class="cnblogs_code">
<div><span style="color: #008000;">//</span><span style="color: #008000;">超过4K的一个超长字符串</span><span style="color: #008000;"><br /></span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">var</span><span style="color: #000000;"> longString</span><span style="color: #000000;">=</span><span style="color: #000000;">'</span><span style="color: #000000;word-wrap:break-word;word-break:break-all;">dfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafddfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsaffsafdsafdfsafdsafbug</span><span style="color: #000000;">'</span><span style="color: #000000;">;<br /><br /><br /></span><span style="color: #008000;">//</span><span style="color: #008000;">写Cookie函数</span><span style="color: #008000;"><br /></span><span style="color: #0000ff;">function</span><span style="color: #000000;"> setCookie(name,value)<br />{<br />   </span><span style="color: #0000ff;">var</span><span style="color: #000000;"> Days </span><span style="color: #000000;">=</span><span style="color: #000000;">1</span><span style="color: #000000;">; </span><span style="color: #008000;">//</span><span style="color: #008000;">此 cookie 将被保存 1 天</span><span style="color: #008000;"><br /></span><span style="color: #0000ff;">var</span><span style="color: #000000;"> exp  </span><span style="color: #000000;">=</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Date();   <br />   exp.setTime(exp.getTime() </span><span style="color: #000000;">+</span><span style="color: #000000;"> Days</span><span style="color: #000000;">*</span><span style="color: #000000;">24</span><span style="color: #000000;">*</span><span style="color: #000000;">60</span><span style="color: #000000;">*</span><span style="color: #000000;">60</span><span style="color: #000000;">*</span><span style="color: #000000;">1000</span><span style="color: #000000;">);<br />   document.cookie </span><span style="color: #000000;">=</span><span style="color: #000000;"> name </span><span style="color: #000000;">+</span><span style="color: #000000;">"</span><span style="color: #000000;">=</span><span style="color: #000000;">"</span><span style="color: #000000;">+</span><span style="color: #000000;"> escape (value) </span><span style="color: #000000;">+</span><span style="color: #000000;">"</span><span style="color: #000000;">;expires=</span><span style="color: #000000;">"</span><span style="color: #000000;">+</span><span style="color: #000000;"> exp.toGMTString();<br />}<br /><br /></span><span style="color: #0000ff;">function</span><span style="color: #000000;"> getCookie(name)</span><span style="color: #008000;">//</span><span style="color: #008000;">取cookies函数</span><span style="color: #008000;"><br /></span><span style="color: #000000;">{<br />   </span><span style="color: #0000ff;">var</span><span style="color: #000000;"> arr </span><span style="color: #000000;">=</span><span style="color: #000000;"> document.cookie.match(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> RegExp(</span><span style="color: #000000;">"</span><span style="color: #000000;">(^| )</span><span style="color: #000000;">"</span><span style="color: #000000;">+</span><span style="color: #000000;">name</span><span style="color: #000000;">+</span><span style="color: #000000;">"</span><span style="color: #000000;">=([^;]*)(;|$)</span><span style="color: #000000;">"</span><span style="color: #000000;">));<br />   </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(arr </span><span style="color: #000000;">!=</span><span style="color: #0000ff;">null</span><span style="color: #000000;">) </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> unescape(arr[</span><span style="color: #000000;">2</span><span style="color: #000000;">]); </span><span style="color: #0000ff;">return</span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br />}<br /><br /></span><span style="color: #008000;">//</span><span style="color: #008000;">设置Cookie，此处包含文章开头提到的两种情况：</span><span style="color: #000000;"><br />setCookie('test','已经设置的Cookie');</span><span style="color: #008000;"><br /><br />//</span><span style="color: #008000;">设置超长Cookie：</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"><br />setCookie('test',longString);</span><span style="color: #008000;"><br /></span><span style="color: #000000;"><br />alert(</span><span style="color: #000000;">getCookie('test')</span><span style="color: #000000;">)</span>;<br /><span style="color: #000000;"><br /></span></div>
</div>
<p><br /><br /><br />测试结果如下：</p>
<p>&nbsp;(1) 当前页面未设置同名Cookie的情况；</p>
<p>
&nbsp;&nbsp;<img src="http://pic002.cnblogs.com/images/2011/48814/2011032200334176.jpg" alt="" /></p>
<p>结论：</p>
<p>在以上各版本浏览器中写入超过4KB（当然各浏览器情况可能不同，有的是4095字节，有的是4096字节）字符串时会出现无法写入的情况，</p>
<p>并不能实现截断写入的情况。</p>
<p>(2) 当前页面已设置同名Cookie的情况；&nbsp;&nbsp; 
</p>
<p><img src="http://pic002.cnblogs.com/images/2011/48814/2011032200355132.jpg" alt="" /></p>
<p><span style="font-size: 14px;">结论：</span></p>
<p>在以上各版本浏览器中当已经存在键名为 'test' 的值时，写入超过4KB（当然各浏览器情况可能不同，有的是4095字节，有的是4096字节）字符串时：</p>
<p>&nbsp;1. 在IE6与IE7下，当无法写入超长字符串时，会影响原有键名为'test'的Cookie值，在测试结果中可以看到此Cookie值已经被清除；</p>
<p>&nbsp;2. 而在其他浏览器中，当无法写入超长字符串时，并不会影响到原有同键名的Cookie值，原有Cookie值依然可以正常读取。</p>
<p>仅供参考，希望对大家有帮助。</p>
