<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="关于不同浏览器下Cookie内容长度限制的测试猫扑的Blog" />
    <meta name="keywords" content="关于不同浏览器下Cookie内容长度限制的测试,前端模块化,前端工程,富应用开发,html5上传,前端数据监控,性能优化,web performance,编辑器,ueditor" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://skyaspnet.github.io//feed.xml">
    <title>关于不同浏览器下Cookie内容长度限制的测试 前端路上的猫扑</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="Shortcut Icon" href="/public/images/favicon.ico" />
    <link rel="Bookmark" href="/public/images/favicon.ico" />
    <link rel="stylesheet" href="/public/css/normalize.css">
    <link rel="stylesheet" href="/public/css/base.css">
    <link rel="stylesheet" href="/public/css/fextm.css">
</head>

<body>
    <!--[if lt IE 8]>
<p class="browsehappy">您使用的浏览器版本<strong>过老</strong>，请<a href="http://browsehappy.com/">使用最新的浏览器</a>来提升浏览体验。</p>
<![endif]-->
    <div class="page-header">
    <a href="/"><div class="logo"></div></a>
    <ul class="page-nav page-navi-articles">
        <li><a href="/">首页</a></li>
        <li><a href="/articles/">技术</a></li>
        <!-- <li><a href="/team.html">团队</a></li> -->
        <li><a href="/about/">关于猫扑</a></li>
        <li><a href="https://github.com/skyaspnet/" target="_blank">Github</a></li>
        <li><a href="https://speakerdeck.com/skyaspnet" target="_blank">Slides</a></li>
    </ul>
    <a class="rss" target="_blank" href="/feed.xml"></a>
</div>



<link rel="stylesheet" href="/public/css/synatx.css">

<div class="container">
    <article>
        <div class="article-info">
        
            
                <img src="/img/avatar/mop.png" onerror="/img/avatar/fex.png" />
            
        
            <h1 class="title">关于不同浏览器下Cookie内容长度限制的测试</h1>
            <div class="author">mop | 15 Mar 2011</div>
        </div>

        <div class="content">
        <p>由于项目的需要，进行一个COOKIE内容长度的限制测试，作一个记录供参考，测试设计如下，分两种情况：</p>

<p>&nbsp; (1) 当前页面未设置同名Cookie的情况；</p>

<p>&nbsp; (2) 当前页面已设置同名Cookie的情况；</p>

<p>主要测试代码如下：</p>

<div class="cnblogs_code">
<div><span style="color: #008000;">//</span><span style="color: #008000;">超过4K的一个超长字符串</span><span style="color: #008000;"><br /></span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">var</span><span style="color: #000000;"> longString</span><span style="color: #000000;">=</span><span style="color: #000000;">'</span><span style="color: #000000;word-wrap:break-word;word-break:break-all;">dfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafddfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsafdfsafdsaffsafdsafdfsafdsafbug</span><span style="color: #000000;">'</span><span style="color: #000000;">;<br /><br /><br /></span><span style="color: #008000;">//</span><span style="color: #008000;">写Cookie函数</span><span style="color: #008000;"><br /></span><span style="color: #0000ff;">function</span><span style="color: #000000;"> setCookie(name,value)<br />{<br />   </span><span style="color: #0000ff;">var</span><span style="color: #000000;"> Days </span><span style="color: #000000;">=</span><span style="color: #000000;">1</span><span style="color: #000000;">; </span><span style="color: #008000;">//</span><span style="color: #008000;">此 cookie 将被保存 1 天</span><span style="color: #008000;"><br /></span><span style="color: #0000ff;">var</span><span style="color: #000000;"> exp  </span><span style="color: #000000;">=</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Date();   <br />   exp.setTime(exp.getTime() </span><span style="color: #000000;">+</span><span style="color: #000000;"> Days</span><span style="color: #000000;">*</span><span style="color: #000000;">24</span><span style="color: #000000;">*</span><span style="color: #000000;">60</span><span style="color: #000000;">*</span><span style="color: #000000;">60</span><span style="color: #000000;">*</span><span style="color: #000000;">1000</span><span style="color: #000000;">);<br />   document.cookie </span><span style="color: #000000;">=</span><span style="color: #000000;"> name </span><span style="color: #000000;">+</span><span style="color: #000000;">"</span><span style="color: #000000;">=</span><span style="color: #000000;">"</span><span style="color: #000000;">+</span><span style="color: #000000;"> escape (value) </span><span style="color: #000000;">+</span><span style="color: #000000;">"</span><span style="color: #000000;">;expires=</span><span style="color: #000000;">"</span><span style="color: #000000;">+</span><span style="color: #000000;"> exp.toGMTString();<br />}<br /><br /></span><span style="color: #0000ff;">function</span><span style="color: #000000;"> getCookie(name)</span><span style="color: #008000;">//</span><span style="color: #008000;">取cookies函数</span><span style="color: #008000;"><br /></span><span style="color: #000000;">{<br />   </span><span style="color: #0000ff;">var</span><span style="color: #000000;"> arr </span><span style="color: #000000;">=</span><span style="color: #000000;"> document.cookie.match(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> RegExp(</span><span style="color: #000000;">"</span><span style="color: #000000;">(^| )</span><span style="color: #000000;">"</span><span style="color: #000000;">+</span><span style="color: #000000;">name</span><span style="color: #000000;">+</span><span style="color: #000000;">"</span><span style="color: #000000;">=([^;]*)(;|$)</span><span style="color: #000000;">"</span><span style="color: #000000;">));<br />   </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(arr </span><span style="color: #000000;">!=</span><span style="color: #0000ff;">null</span><span style="color: #000000;">) </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> unescape(arr[</span><span style="color: #000000;">2</span><span style="color: #000000;">]); </span><span style="color: #0000ff;">return</span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br />}<br /><br /></span><span style="color: #008000;">//</span><span style="color: #008000;">设置Cookie，此处包含文章开头提到的两种情况：</span><span style="color: #000000;"><br />setCookie('test','已经设置的Cookie');</span><span style="color: #008000;"><br /><br />//</span><span style="color: #008000;">设置超长Cookie：</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;"><br />setCookie('test',longString);</span><span style="color: #008000;"><br /></span><span style="color: #000000;"><br />alert(</span><span style="color: #000000;">getCookie('test')</span><span style="color: #000000;">)</span>;<br /><span style="color: #000000;"><br /></span></div>
</div>

<p><br /><br /><br />测试结果如下：</p>

<p>&nbsp;(1) 当前页面未设置同名Cookie的情况；</p>

<p>
&nbsp;&nbsp;<img src="http://pic002.cnblogs.com/images/2011/48814/2011032200334176.jpg" alt="" /></p>
<p>结论：</p>
<p>在以上各版本浏览器中写入超过4KB（当然各浏览器情况可能不同，有的是4095字节，有的是4096字节）字符串时会出现无法写入的情况，</p>
<p>并不能实现截断写入的情况。</p>
<p>(2) 当前页面已设置同名Cookie的情况；&nbsp;&nbsp; 
</p>

<p><img src="http://pic002.cnblogs.com/images/2011/48814/2011032200355132.jpg" alt="" /></p>

<p><span style="font-size: 14px;">结论：</span></p>

<p>在以上各版本浏览器中当已经存在键名为 'test' 的值时，写入超过4KB（当然各浏览器情况可能不同，有的是4095字节，有的是4096字节）字符串时：</p>

<p>&nbsp;1. 在IE6与IE7下，当无法写入超长字符串时，会影响原有键名为'test'的Cookie值，在测试结果中可以看到此Cookie值已经被清除；</p>

<p>&nbsp;2. 而在其他浏览器中，当无法写入超长字符串时，并不会影响到原有同键名的Cookie值，原有Cookie值依然可以正常读取。</p>

<p>仅供参考，希望对大家有帮助。</p>

        </div>

        <div class="author">
        
            
                作者：<a href="http://skyaspnet.github.io/" target="_blank">mop (http://skyaspnet.github.io/)</a> - skyaspnet <br/>
                <a href="http://skyaspnet.github.io/" target="_blank"></a> <br/>
                <!-- <a href="/posts/#mop">查看他|她写的全部文章</a>  |   -->
            
        
        </div>

        <!-- Duoshuo Comment BEGIN -->
<a name="comments"> </a>
<div id="comment">
    <div class="ds-thread" data-title="关于不同浏览器下Cookie内容长度限制的测试"></div>
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"skyaspnet"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
</div>
<!-- Duoshuo Comment END -->
    </article>

    <div class="page-sidebar">
    <!-- <div>
        <img src="/public/images/formula.png" />
    </div> -->

    <ul class="github-projects">
        
            <li><a href="https://github.com/skyaspnet/wenke" target="_blank">wenke - 腾讯问问 & 百科前端自动化构建工具</a></li>
        
            <li><a href="https://github.com/skyaspnet/mcheerio" target="_blank">mcheerio - fix some issues for cheerio</a></li>
        
            <li><a href="https://github.com/skyaspnet/wenke-monitor" target="_blank">wenke-monitor - 腾讯问问 & 百科 前端页面监控</a></li>
        
            <li><a href="https://github.com/skyaspnet/baidu_pcs_sdk" target="_blank">baidu_pcs_sdk - 百度个人云存储PHP SDK</a></li>
        
            <li><a href="https://github.com/skyaspnet/tconverter" target="_blank">tconverter - Tapestry 转 velocity 工具 （C#）</a></li>
        
    </ul>
</div>


</div>


<div class="page-footer">
    <div class="foot-inner">
     powered by skyaspnet   <span style="margin-left: 15px;">基于jekyll 和 Baidu FEX提供的模板</span>
    </div>
</div>



<script>
var page = "/blog/2011/03/cookies-length-limit";
</script>


<script type="text/javascript">
//设置站外链接新页面打开
var a_list = document.getElementsByTagName("a");
for (var i = 0; i < a_list.length; i++) {
    var href = a_list[i];
    if (href.hostname.indexOf(location.hostname) < 0) {
        href.target = "_blank";
    }
}
</script>
</body>

</html>

